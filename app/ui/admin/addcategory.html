<F3:include href="common/header.html" />

<script type="text/javascript">
	var now_name = [];

	function del_child(me,child_name)
	{
		for(var k in now_name)
			if(now_name[k] == child_name)
			{
				now_name[k] = "kjlmfe";
				break;
	        }
		$(me).parent().remove();
	}

	$(function(){

		$('.old_child_name').each(function(){
		
			var name = $(this).html();	
			now_name.push(name);
		});

		/***************/
		var url = "{{@WEB_ROOT}}device/get/category?want=child&json=true&id=-1";
		autoCompleteGetJSON("#child_name",url,"#add_child");
		/***************/

		var cnt = 3000;
		$("#add_child").click(function(){
			var child_name = $.trim($("#child_name").val());
			var child_id = $("#child_id").val();
			var child_py = "";
			var title = "oldchild";

			$("#child_name").val("").focus();
			$("#child_id").val("");

			if(child_name == "")
				return;

			for(var k in now_name)
			{
				if(now_name[k] == child_name)
				{
					alert(child_name + " 该子属性已经存在");
					return;
				}
			}

			if(child_id == "")
			{
				title = "newchild";
				while(1)
				{
					child_py = $.trim(prompt("请输入 <" +child_name+"> 的拼音首字母缩写(用于拼音自动补全):"));
					if(child_py != "")
						break;
				}
			}
			cnt++;
			now_name.push(child_name);
			$("#child_group").prepend(
				"<div class='btn-group span4' style='margin-top:5px;margin-left:5px;'>"+
					"<button class='btn'>"+child_name+"</button>"+
					"<button class='btn btn-danger' onclick='del_child(this,"+"\""+child_name+"\""+")'>X</button>"+
					"<input type='hidden' name='"+title+"name-"+cnt+"' value='"+child_name+"'>"+
					"<input type='hidden' name='"+title+"id-"+cnt+"' value='"+child_id+"'>"+
					"<input type='hidden' name='"+title+"py-"+cnt+"' value='"+child_py+"'>"+
				"</div>"
				);
		});
	});
</script>

	<div class="container">
		<div class="row">
			<div class="span7 offset2">
				<form class="form-horizontal" action="" method="post" name="d" onSubmit="return false;">

		<F3:check if="{{@old_name}}">
				<F3:true>
					<h3>修改性能参数分类</h3>
				</F3:true>
				<F3:false>
					<h3>添加性能参数分类</h3>
				</F3:false>
		</F3:check>


		<F3:check if="{{@has_submit}}">
			<F3:check if="{{@success}}">
				<F3:true>
					<div class="alert alert-success" style="display:">
						<button class="close" data-dismiss="alert">&times;</button>
						<h4 class="alert-heading">操作成功！</h4>
				</F3:true>
				<F3:false>
					<div class="alert alert-error">
						<button class="close" data-dismiss="alert">&times;</button>
						<h4 class="alert-heading">操作失败！</h4>
				</F3:false>
			</F3:check>
						<p>{{@msg}}</p>
					</div>
		</F3:check>

					<div class="control-group">
						<label class="control-label">名称*</label>
						<div class="controls">
		<F3:check if="{{@old_name}}">
				<F3:true>
							<input disabled type="text" class="span3" value="{{@old_name}}">
							<input name="name" type="hidden" class="span3" value="{{@old_name}}">
				</F3:true>
				<F3:false>
							<input name="name"  type="text" class="span3" value="{{@old_name}}" placeholder="请输入名称">
				</F3:false>
		</F3:check>

							<input name="old_id"  type="hidden" value="{{@old_id}}">
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">拼音首字母缩写*</label>
						<div class="controls">
							<input name="pysx" type="text" class="span2" value="{{@old_pysx}}" placeholder="请输入拼音缩写">
							<span class="help-block">用于拼音自动补全</span>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">增加子属性*</label>
						<div class="controls">
							<input id="child_name" type="text" class="span2" maxlength="12" placeholder="">
							<input id="child_id" type="hidden" class="span2" value="">
							<button id="add_child" type="button" class="btn btn-primary">添加</button>
						</div>
					</div>
					
					<h3>已有子属性:</h3>
					<div id="child_group" class="row-fluid">
					<F3:repeat group="{{@DB->result}}" value="{{@v}}" counter="{{@c}}">
							<div class="btn-group span4" style="margin-top:5px;margin-left:5px;">
  								<label class="old_child_name">{{@v.name}}</label>
                                  <!--<button class="btn btn-danger" onclick='del_child(this)'>X</button>-->
								<input type='hidden' name='oldchildname-{{@c}}' value='{{@v.name}}'>
								<input type='hidden' name='oldchildid-{{@c}}' value='{{@v.id}}'>
								<input type='hidden' name='oldchildpy-{{@c}}' value='{{@v.py}}'>
							</div>
					</F3:repeat>

					</div>

					<div class="form-actions">
						<div class="controls btn-groups">
							<button type="button" onClick="document.d.submit()"class="btn btn-primary">保存</button>
							<button type="reset" class="btn" onclick="location.href='{{@WEB_ROOT}}category/list'">取消</button>
						</div>
					</div>

				</form>
			</div>
		</div>
	</div><!-- Container -->

<F3:include href="common/footer.html" />
